# Chess Phase 2

[Phase 2 Sequence Diagram](https://sequencediagram.org/index.html?presentationMode=readOnly#initialData=IYYwLg9gTgBAwgGwJYFMB2YBQAHYUxIhK4YwDKKUAbpTngUSWDABLBoAmCtu+hx7ZhWqEUdPo0EwAIsDDAAgiBAoAzqswc5wAEbBVKGBx2ZM6MFACeq3ETQBzGAAYAdAE5M9qBACu2AMQALADMABwATG4gMP7I9gAWYDoIPoYASij2SKoWckgQaJiIqKQAtAB85JQ0UABcMADaAAoA8mQAKgC6MAD0PgZQADpoAN4ARP2UaMAAtihjtWMwYwA0y7jqAO7QHAtLq8soM8BICHvLAL6YwjUwFazsXJT145NQ03PnB2MbqttQu0WyzWYyOJzOQLGVzYnG4sHuN1E9SgmWyYEoAAoMlkcpQMgBHVI5ACU12qojulVk8iUKnU9XsKDAAFUBhi3h8UKTqYplGpVJSjDpagAxJCcGCsyg8mA6SwwDmzMQ6FHAADWkoGME2SDA8QVA05MGACFVHHlKAAHmiNDzafy7gjySp6lKoDyySIVI7KjdnjAFKaUMBze11egAKKWlTYAgFT23Ur3YrmeqBJzBYbjObqYCMhbLCNQbx1A1TJXGoMh+XyNXoKFmTiYO189Q+qpelD1NA+BAIBMU+4tumqWogVXot3sgY87nae1t+7GWoKDgcTXS7QD71D+et0fj4PohQ+PUY4Cn+Kz5t7keC5er9cnvUexE7+4wp6l7FovFqXtYJ+cLtn6pavIaSpLPU+wgheertBAdZoFByyXAmlDtimGD1OEThOFmEwQZ8MDQcCyxwfECFISh+xXOgHCmJ43h+P40DsIyMQinAEbSHACgwAAMhAWSFFhzBOtQ-rNG0XS9AY6j5GgWaKnMay-P8HBXKBgpAf6IwqSgan6H8OzQo8wESVQSIwAgwnihiQkiQSRJgKSb6GLuNL7gyTJTgZc5eXeS7CjAYoSm6MpymW7xKpgKrBhqAByEAwKoPggPqbwwNAMDiiA0AouAMDqTsN6BQ6Sa+s6XYbu6W7uSB1T+sy0yXtASAAF4oBwUYxnGhTaZV8DIKmMDpgAjAROaqHm8zQUWJb1OKVAmkg66Hhw5hICaqgNvRZW8kFlnWRF9XVYKw78vUh5yCgz7xOel7Xpdi6VMuAZrgGT1nZ27a6aWjnihkaUIIB5kYUNoEvAZawUVR6BaU18LJiN2EwLh+GjDDxqXvDaB0U2pheL4AReCg6AxHEiRkxTjm+FgYmClDjTSBGAkRu0EbdD08mqIpwxw4h6DofClT-fUgtIZg-1M9V9S2fY9MOcJ9POWornbh5VK3ldMCMmA92PfBQtoAFh0VW9IVhU+33yHFqoagAkmgK3IOukvCy9AqQ3LMA9n2muNZJpYtRR7VdT10YoLGiki5hqNgGmTiTaMYzTbNBZjAt0BLS7q3u7jJt7U2XtB1ZLpfS+P3l1rMg6-SRgoNwx6XkblEm2bC7e5b9TSE3TKGPdr7nUN4uCSrp7AwB0vg8jVXB-UaX7jA6eMnHQ1iTheFTfyGfQXTp6pelI4AGa9sXDFE8xAQouu-jYOKGoCWiMAAOJKhojOWVJr8c9z9hKgFoXKWg0xazwlsA4WMtjoV2QDkd+OYHJogQWoNWJJA6eXNg3fWhsPamwOl3e8VtxQ2yrnbeK6oYDO1dmtHGxspalx9p2bsvZ+wNSYTUV0rU9Th26r1aO-V14oxKInMaycd65nzPNYsOdcp5zdnQ9u1ECYMUYTAmqQ9q6Dm1uVbBTJAwIBQaoDEndl7BXqBkMAPh3iCTRAAHhQTycoGCPzgNsfAj+U9QYz1hBDb+pYAFzBsi-AAUmQFoiUhGVE3ujbeoxAlqHqA0FwKTOgqMYsTFiHAADsbgnAoCcDECMwQ4DcQAGzwAnIYFBMAigJ1lgvRorQOj-0AdwpR6AswJMSkqRGwcdJuLwWsbpsVoHzxrtdKpKCMRwCmUqNBGt2E6KwaOPW+jW54NMUFHuoUSGVyvFuChTt5G0LwQQsx6iWEB3Yf4rhYcoCdT4VHGO8ZBrCNGhNCRM0pGFhkaWZa+dFF4wvuco64zrKaLtksuuujVnigGGAaZCTnr127kKeoj435KmHr9UebjZlHhQCgrxYNfFzw7JwmAIwEmO2kH0xM7y0YYy6UqWl6Sr4k38JYJutlNiUyQAkMA3K+wQD5SEiA4osVBP8MkUAao6kiIaZS5ozJZI9ASUA+hnTRjYAQMAblUA4AQFslAYZrK6XrzAWSiBWq0BqT1Qao1JqzVzFpT4r8SrrIACsJVoGmeK8UxKUCEnVm5Eeyyu4+QNhsyB+DGE7Otvsj0RyqEnILra0FFVLl+1YS48ZzV2m8Mjn1WObzokJyTinbMu8flZz+bnGh6aOnIXSWo8FFdIXAAwRG7yazEVKgxDS6QWyLbot2RKRxhyHZSsMGgCAzAT6+BLqisu1l-ZsJHrcmAAAhEMCz+EvIGkjeOIik6Y2rZIuavzFp6wrHOhdS7ditpXRw6yk6oXhphSs+ofgtDohQQAdV1PEJoDrMRDrWPlZ10VOQjtemO5k2A-3VOxVo98Vqvz1ADX6+Z-5vHQK3T6yVS8RxROGqe2J56041qvWMbDR99xnzOOyzJpMoD6v5YKrwHHEDBlgMAbAurCB5AKLUr++bSwNFZuzTm3NjCWoeNamAGI51oC5O6iy7aaogG4HgEx3av2RpgDpvjbpjFwbRe9PuzdDAmgQLVHFNcLqouurpqAhsLNEN7v3dElZ7OdoM17VzfGjH6fjWO6zA8-Mzsc4OVxSneN4BJRpvxEmXirxqmMHkegDDGbc91BsZbyOjWZanDLmdsv6EMCZvABX0lAA)

## Code
```uml
actor Client
actor Client
participant Server
participant Handler
participant Service
participant DataAccess
database db

entryspacing 0.9
group#43829c #lightblue Registration
Client -> Server: [POST] /user\n{"username":" ", "password":" ", "email":" "}
Server -> Handler: {"username":" ", "password":" ", "email":" "}
Handler -> Service: register(RegisterRequest)
Service -> DataAccess: getUser(username)
DataAccess -> db:Find UserData by username
break User with username already exists
DataAccess --> Service: UserData
Service --> Server: AlreadyTakenException
Server --> Client: 403\n{"message": "Error: username already taken"}
end
DataAccess --> Service: null
Service -> DataAccess:createUser(userData)
DataAccess -> db:Add UserData
Service -> DataAccess:createAuth(authData)
DataAccess -> db:Add AuthData
Service --> Handler: RegisterResult
Handler --> Server: {"username" : " ", "authToken" : " "}
Server --> Client: 200\n{"username" : " ", "authToken" : " "}
end


group#orange #FCEDCA Login
Client -> Server: [POST] /session\n{username, password}
Server -> Handler: {username, password}
Handler -> Service: login(LoginRequest)
Service -> DataAccess: getUser(username)
DataAccess -> db: Find UserData by username
break No such user or incorrect password
DataAccess --> Service: UserData
Service --> Server: UnauthorizedException
Server --> Client: 401\n{"message": "Error: invalid credentials"}
end
DataAccess --> Service: UserData
Service -> DataAccess: createAuth(authData)
DataAccess -> db: Add AuthData
Service --> Handler: LoginResult
Handler --> Server: {username, authToken}
Server --> Client: 200\n{username, authToken}
end


group#green #lightgreen Logout
Client -> Server: [DELETE] /session\nauthToken
Server -> Handler: authToken
Handler -> Service: logout(LogoutRequest)
Service -> DataAccess: getAuth(authToken)
DataAccess -> db: Find AuthData
break Invalid authToken
DataAccess --> Service: null
Service --> Server: UnauthorizedException
Server --> Client: 401\n{"message": "Error: invalid authToken"}
end
DataAccess --> Service: AuthData
Service -> DataAccess: deleteAuth(authToken)
DataAccess -> db: Delete AuthData
Service --> Handler: LogoutResult
Handler --> Server: success message
Server --> Client: 200\n{"message": "Logout successful"}
end


group#red #pink List Games
Client -> Server: [GET] /game\nauthToken
Server -> Handler: authToken
Handler -> Service: listGames(ListGamesRequest)
Service -> DataAccess: getAuth(authToken)
DataAccess -> db: Find AuthData
break Invalid authToken
DataAccess --> Service: null
Service --> Server: UnauthorizedException
Server --> Client: 401\n{"message": "Error: invalid authToken"}
end
DataAccess --> Service: AuthData
Service -> DataAccess: getAllGames()
DataAccess -> db: Return List<GameData>
Service --> Handler: ListGamesResult
Handler --> Server: game list JSON
Server --> Client: 200\n{games: [...]}
end


group#d790e0 #E3CCE6 Create Game 
Client -> Server: [POST] /game\nauthToken\n{gameName}
Server -> Handler: authToken, gameName
Handler -> Service: createGame(CreateGameRequest)
Service -> DataAccess: getAuth(authToken)
DataAccess -> db: Find AuthData
break Invalid authToken
DataAccess --> Service: null
Service --> Server: UnauthorizedException
Server --> Client: 401\n{"message": "Error: invalid authToken"}
end
DataAccess --> Service: AuthData
Service -> DataAccess: insertGame(gameData)
DataAccess -> db: Add GameData
Service --> Handler: CreateGameResult
Handler --> Server: {gameID}
Server --> Client: 200\n{gameID}
end


group#yellow #lightyellow Join Game #black
Client -> Server: [PUT] /game\nauthToken\n{playerColor, gameID}
Server -> Handler: authToken, playerColor, gameID
Handler -> Service: joinGame(JoinGameRequest)
Service -> DataAccess: getAuth(authToken)
DataAccess -> db: Find AuthData
break Invalid authToken
DataAccess --> Service: null
Service --> Server: UnauthorizedException
Server --> Client: 401\n{"message": "Error: invalid authToken"}
end
DataAccess --> Service: AuthData
Service -> DataAccess: getGame(gameID)
DataAccess -> db: Find GameData
break Game not found
DataAccess --> Service: null
Service --> Server: BadRequestException
Server --> Client: 400\n{"message": "Error: game not found"}
end
DataAccess --> Service: GameData
Service -> DataAccess: updateGameWithPlayer(gameID, color, username)
DataAccess -> db: Update GameData
Service --> Handler: JoinGameResult
Handler --> Server: join success
Server --> Client: 200\n{"message": "Join successful"}
end

group#gray #lightgray Clear application 
Client -> Server: [DELETE] /db
Server -> Handler: (none)
Handler -> Service: clear()
Service -> DataAccess: clearUsers()
DataAccess -> db: Delete all UserData
Service -> DataAccess: clearAuth()
DataAccess -> db: Delete all AuthData
Service -> DataAccess: clearGames()
DataAccess -> db: Delete all GameData
Service --> Handler: ClearResult
Handler --> Server: {message: "Database cleared"}
Server --> Client: 200\n{"message": "Database cleared"}
end

```
